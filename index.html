<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sand Dollar Consumer Adoption Survey</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for Inter font and general aesthetics */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .likert-option {
            transition: all 0.2s;
        }
        .likert-option:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            transform: translateY(-1px);
        }
        input[type="radio"]:checked + label {
            background-color: #10b981; /* Emerald 500 */
            color: white;
            border-color: #10b981;
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="max-w-3xl mx-auto bg-white p-6 sm:p-10 rounded-xl shadow-2xl border border-gray-100">
        <!-- System Refresh Placeholder B -->

        <!-- Header -->
        <header class="mb-8 border-b pb-4">
            <h1 class="text-3xl font-extrabold text-gray-900 mb-2">Sand Dollar Consumer Adoption Survey</h1>
            <p class="text-lg text-gray-500">Academic Research Project: BUSI-951-01 Introduction to Financial Technologies (FinTech) in Financial Services Fall 2025</p>
        </header>

        <!-- Researcher Introduction -->
        <div class="mb-10 p-6 bg-blue-50 border-l-4 border-blue-500 rounded-lg">
            <h2 class="text-xl font-semibold text-blue-800 mb-3">Introduction from the Researcher</h2>
            <p class="text-gray-700 leading-relaxed">
                Dear Participant,
            </p>
            <p class="text-gray-700 leading-relaxed mt-2">
                My name is **Renee Darling Neymour**, and I am a student in the **BUSI-951-01 Introduction to Financial Technologies (FinTech) in Financial Services Fall 2025** class.
            </p>
            <p class="text-gray-700 leading-relaxed mt-2">
                I am conducting this anonymous survey as part of an academic research project focused on digital currency adoption barriers in The Bahamas.
            </p>
            <p class="text-gray-700 leading-relaxed mt-2 font-medium">
                Your participation is incredibly valuable. Please be assured that all responses are strictly confidential and the results will **only** be used for the purpose of this research paper.
            </p>
            <p class="text-gray-700 leading-relaxed mt-2">
                Thank you for taking the time to complete this survey.
            </p>
        </div>

        <form id="sandDollarSurveyForm" class="space-y-10">

            <!-- 0.0. Consent Question -->
            <section id="section-consent">
                <h3 class="text-xl font-bold text-gray-700 mb-4">Start of Survey: Consent</h3>
                <p class="text-base text-gray-600 mb-4">0.0. Permission to Complete Survey</p>
                <p class="text-sm italic text-gray-500 mb-6">
                    This anonymous survey is for academic research only and is designed to assess public attitudes toward digital currency incentives in The Bahamas. Your responses will be kept confidential and used solely for this research paper. Do you agree to participate in this survey?
                </p>

                <div class="flex flex-wrap gap-4">
                    <input type="radio" id="consent_yes" name="consent" value="Yes" class="hidden" required>
                    <label for="consent_yes" class="px-6 py-3 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors">Yes, I consent to participate</label>

                    <input type="radio" id="consent_no" name="consent" value="No" class="hidden">
                    <label for="consent_no" class="px-6 py-3 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors">No, I do not consent</label>
                </div>
            </section>

            <!-- Section 0: Demographic Information -->
            <section id="section-demographics">
                <h3 class="text-xl font-bold text-gray-700 mb-4 border-t pt-6">Section 0: Demographic Information</h3>
                <p class="text-sm text-gray-600 mb-6">These questions help us understand if adoption barriers or incentives vary across different groups.</p>

                <!-- Question A: Gender -->
                <div class="mb-6">
                    <label class="block text-gray-800 font-semibold mb-3">A. Gender:</label>
                    <div class="flex flex-wrap gap-4">
                        <input type="radio" id="gender_f" name="gender" value="Female" class="hidden" required>
                        <label for="gender_f" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">Female</label>
                        
                        <input type="radio" id="gender_m" name="gender" value="Male" class="hidden">
                        <label for="gender_m" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">Male</label>
                        
                        <input type="radio" id="gender_pns" name="gender" value="Prefer not to say" class="hidden">
                        <label for="gender_pns" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">Prefer not to say</label>
                    </div>
                </div>

                <!-- Question B: Age Range -->
                <div class="mb-6">
                    <label class="block text-gray-800 font-semibold mb-3">B. Age Range:</label>
                    <div class="flex flex-wrap gap-4">
                        <input type="radio" id="age_18" name="age" value="18-24" class="hidden" required>
                        <label for="age_18" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">18-24</label>

                        <input type="radio" id="age_25" name="age" value="25-34" class="hidden">
                        <label for="age_25" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">25-34</label>

                        <input type="radio" id="age_35" name="age" value="35-49" class="hidden">
                        <label for="age_35" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">35-49</label>

                        <input type="radio" id="age_50" name="age" value="50-64" class="hidden">
                        <label for="age_50" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">50-64</label>

                        <input type="radio" id="age_65" name="age" value="65+" class="hidden">
                        <label for="age_65" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">65+</label>
                    </div>
                </div>

                <!-- Question C: Employment Status -->
                <div class="mb-6">
                    <label class="block text-gray-800 font-semibold mb-3">C. Employment Status:</label>
                    <div class="flex flex-wrap gap-4">
                        <input type="radio" id="emp_ft" name="employment" value="Employed Full-Time" class="hidden" required>
                        <label for="emp_ft" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">Employed Full-Time</label>

                        <input type="radio" id="emp_pt" name="employment" value="Employed Part-Time" class="hidden">
                        <label for="emp_pt" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">Employed Part-Time</label>

                        <input type="radio" id="emp_se" name="employment" value="Self-Employed" class="hidden">
                        <label for="emp_se" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">Self-Employed</label>

                        <input type="radio" id="emp_st" name="employment" value="Student" class="hidden">
                        <label for="emp_st" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">Student</label>

                        <input type="radio" id="emp_re" name="employment" value="Retired" class="hidden">
                        <label for="emp_re" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">Retired</label>

                        <input type="radio" id="emp_un" name="employment" value="Unemployed" class="hidden">
                        <label for="emp_un" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">Unemployed</label>
                    </div>
                </div>

                <!-- Question D: Education -->
                <div class="mb-6">
                    <label class="block text-gray-800 font-semibold mb-3">D. Highest Level of Education Completed:</label>
                    <div class="flex flex-wrap gap-4">
                        <input type="radio" id="edu_hs" name="education" value="High School Diploma or equivalent" class="hidden" required>
                        <label for="edu_hs" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">High School Diploma or equivalent</label>

                        <input type="radio" id="edu_vtc" name="education" value="Vocational/Trade Certificate" class="hidden">
                        <label for="edu_vtc" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">Vocational/Trade Certificate</label>

                        <input type="radio" id="edu_ad" name="education" value="Associate's Degree" class="hidden">
                        <label for="edu_ad" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">Associate's Degree</label>

                        <input type="radio" id="edu_bd" name="education" value="Bachelor's Degree" class="hidden">
                        <label for="edu_bd" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">Bachelor's Degree</label>

                        <input type="radio" id="edu_gd" name="education" value="Graduate Degree or higher" class="hidden">
                        <label for="edu_gd" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">Graduate Degree or higher</label>
                    </div>
                </div>
            </section>

            <!-- Likert Scale Legend -->
            <div class="flex justify-between text-xs text-gray-600 font-medium px-4 py-2 bg-gray-100 rounded-lg shadow-inner">
                <span class="text-red-600">1: Strongly Disagree</span>
                <span>2: Disagree</span>
                <span class="text-center">3: Neither Agree nor Disagree</span>
                <span>4: Agree</span>
                <span class="text-green-600">5: Strongly Agree</span>
            </div>

            <!-- Section 1: Identifying Current Barriers to Use -->
            <section id="section-barriers">
                <h3 class="text-xl font-bold text-gray-700 mb-6 border-t pt-6">Section 1: Identifying Current Barriers (Likert Scale)</h3>
                <p class="text-sm text-gray-600 mb-8">These questions aim to understand why consumers aren't using the Sand Dollar right now.</p>

                <!-- Question 1 -->
                <div class="mb-8">
                    <label class="block text-lg font-medium text-gray-800 mb-4">1. Barrier - Preference for Existing Methods:</label>
                    <p class="text-sm text-gray-600 mb-4">"I rarely use the Sand Dollar because my existing payment methods (cash, debit/credit card) are more convenient."</p>
                    <div class="flex justify-between space-x-2 sm:space-x-4">
                        <!-- Likert scale options 1 to 5 -->
                        <input type="radio" id="q1_1" name="q1_preference" value="1" class="hidden" required><label for="q1_1" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-red-50">1</label>
                        <input type="radio" id="q1_2" name="q1_preference" value="2" class="hidden"><label for="q1_2" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-red-50">2</label>
                        <input type="radio" id="q1_3" name="q1_preference" value="3" class="hidden"><label for="q1_3" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-gray-50">3</label>
                        <input type="radio" id="q1_4" name="q1_preference" value="4" class="hidden"><label for="q1_4" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-green-50">4</label>
                        <input type="radio" id="q1_5" name="q1_preference" value="5" class="hidden"><label for="q1_5" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-green-50">5</label>
                    </div>
                </div>

                <!-- Question 2 -->
                <div class="mb-8">
                    <label class="block text-lg font-medium text-gray-800 mb-4">2. Barrier - Merchant Acceptance:</label>
                    <p class="text-sm text-gray-600 mb-4">"Most of the businesses and merchants where I shop regularly do not accept the Sand Dollar."</p>
                    <div class="flex justify-between space-x-2 sm:space-x-4">
                        <input type="radio" id="q2_1" name="q2_acceptance" value="1" class="hidden" required><label for="q2_1" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-red-50">1</label>
                        <input type="radio" id="q2_2" name="q2_acceptance" value="2" class="hidden"><label for="q2_2" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-red-50">2</label>
                        <input type="radio" id="q2_3" name="q2_acceptance" value="3" class="hidden"><label for="q2_3" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-gray-50">3</label>
                        <input type="radio" id="q2_4" name="q2_acceptance" value="4" class="hidden"><label for="q2_4" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-green-50">4</label>
                        <input type="radio" id="q2_5" name="q2_acceptance" value="5" class="hidden"><label for="q2_5" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-green-50">5</label>
                    </div>
                </div>

                <!-- Question 3 -->
                <div class="mb-8">
                    <label class="block text-lg font-medium text-gray-800 mb-4">3. Barrier - Trust and Privacy:</label>
                    <p class="text-sm text-gray-600 mb-4">"I have concerns about the security or privacy of my money if I use the Sand Dollar."</p>
                    <div class="flex justify-between space-x-2 sm:space-x-4">
                        <input type="radio" id="q3_1" name="q3_trust" value="1" class="hidden" required><label for="q3_1" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-red-50">1</label>
                        <input type="radio" id="q3_2" name="q3_trust" value="2" class="hidden"><label for="q3_2" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-red-50">2</label>
                        <input type="radio" id="q3_3" name="q3_trust" value="3" class="hidden"><label for="q3_3" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-gray-50">3</label>
                        <input type="radio" id="q3_4" name="q3_trust" value="4" class="hidden"><label for="q3_4" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-green-50">4</label>
                        <input type="radio" id="q3_5" name="q3_trust" value="5" class="hidden"><label for="q3_5" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-green-50">5</label>
                    </div>
                </div>
            </section>

            <!-- Section 2: Measuring Receptivity to Financial Incentives -->
            <section id="section-incentives">
                <h3 class="text-xl font-bold text-gray-700 mb-6 border-t pt-6">Section 2: Measuring Receptivity to Financial Incentives (Likert Scale)</h3>
                <p class="text-sm text-gray-600 mb-8">These questions test whether financial incentives are the key missing piece for adoption.</p>

                <!-- Question 4 -->
                <div class="mb-8">
                    <label class="block text-lg font-medium text-gray-800 mb-4">4. Incentive - General Receptivity:</label>
                    <p class="text-sm text-gray-600 mb-4">"I would be significantly more motivated to use the Sand Dollar if it offered me a direct financial benefit (e.g., discounts, rewards)."</p>
                    <div class="flex justify-between space-x-2 sm:space-x-4">
                        <input type="radio" id="q4_1" name="q4_general_incentive" value="1" class="hidden" required><label for="q4_1" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-red-50">1</label>
                        <input type="radio" id="q4_2" name="q4_general_incentive" value="2" class="hidden"><label for="q4_2" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-red-50">2</label>
                        <input type="radio" id="q4_3" name="q4_general_incentive" value="3" class="hidden"><label for="q4_3" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-gray-50">3</label>
                        <input type="radio" id="q4_4" name="q4_general_incentive" value="4" class="hidden"><label for="q4_4" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-green-50">4</label>
                        <input type="radio" id="q4_5" name="q4_general_incentive" value="5" class="hidden"><label for="q4_5" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-green-50">5</label>
                    </div>
                </div>

                <!-- Question 5 -->
                <div class="mb-8">
                    <label class="block text-lg font-medium text-gray-800 mb-4">5. Incentive - Specific VAT Credit Impact:</label>
                    <p class="text-sm text-gray-600 mb-4">"I would choose to pay with the Sand Dollar for most purchases if the government offered a small VAT credit (e.g., 1%) on those transactions."</p>
                    <div class="flex justify-between space-x-2 sm:space-x-4">
                        <input type="radio" id="q5_1" name="q5_vat_credit" value="1" class="hidden" required><label for="q5_1" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-red-50">1</label>
                        <input type="radio" id="q5_2" name="q5_vat_credit" value="2" class="hidden"><label for="q5_2" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-red-50">2</label>
                        <input type="radio" id="q5_3" name="q5_vat_credit" value="3" class="hidden"><label for="q5_3" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-gray-50">3</label>
                        <input type="radio" id="q5_4" name="q5_vat_credit" value="4" class="hidden"><label for="q5_4" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-green-50">4</label>
                        <input type="radio" id="q5_5" name="q5_vat_credit" value="5" class="hidden"><label for="q5_5" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-green-50">5</label>
                    </div>
                </div>

                <!-- Question 6 -->
                <div class="mb-8">
                    <label class="block text-lg font-medium text-gray-800 mb-4">6. Switching Behavior - Current Payment Methods:</label>
                    <p class="text-sm text-gray-600 mb-4">"If the Sand Dollar offered a VAT credit, I would switch from my current primary payment method (card or cash) to the Sand Dollar for daily expenses."</p>
                    <div class="flex justify-between space-x-2 sm:space-x-4">
                        <input type="radio" id="q6_1" name="q6_switching" value="1" class="hidden" required><label for="q6_1" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-red-50">1</label>
                        <input type="radio" id="q6_2" name="q6_switching" value="2" class="hidden"><label for="q6_2" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-red-50">2</label>
                        <input type="radio" id="q6_3" name="q6_switching" value="3" class="hidden"><label for="q6_3" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-gray-50">3</label>
                        <input type="radio" id="q6_4" name="q6_switching" value="4" class="hidden"><label for="q6_4" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-green-50">4</label>
                        <input type="radio" id="q6_5" name="q6_switching" value="5" class="hidden"><label for="q6_5" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-green-50">5</label>
                    </div>
                </div>

                <!-- Question 7 -->
                <div class="mb-8">
                    <label class="block text-lg font-medium text-gray-800 mb-4">7. Attitude - Importance of Financial Benefit:</label>
                    <p class="text-sm text-gray-600 mb-4">"For the Sand Dollar to be widely adopted, it needs to offer a greater financial advantage than commercial bank products."</p>
                    <div class="flex justify-between space-x-2 sm:space-x-4">
                        <input type="radio" id="q7_1" name="q7_importance" value="1" class="hidden" required><label for="q7_1" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-red-50">1</label>
                        <input type="radio" id="q7_2" name="q7_importance" value="2" class="hidden"><label for="q7_2" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-red-50">2</label>
                        <input type="radio" id="q7_3" name="q7_importance" value="3" class="hidden"><label for="q7_3" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-gray-50">3</label>
                        <input type="radio" id="q7_4" name="q7_importance" value="4" class="hidden"><label for="q7_4" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-green-50">4</label>
                        <input type="radio" id="q7_5" name="q7_importance" value="5" class="hidden"><label for="q7_5" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-green-50">5</label>
                    </div>
                </div>
            </section>

            <!-- Submit Button & View Results -->
            <div class="border-t pt-6 flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                <button type="submit" id="submitButton" class="w-full sm:w-1/2 bg-blue-600 text-white font-bold py-3 rounded-xl hover:bg-blue-700 transition-colors shadow-lg shadow-blue-500/50">
                    Submit Survey
                </button>
                <!-- This button is hidden by default and only shown to the researcher via JavaScript -->
                <button type="button" id="viewResultsButton" class="hidden w-full sm:w-1/2 bg-gray-200 text-gray-800 font-bold py-3 rounded-xl hover:bg-gray-300 transition-colors" onclick="switchView('results')">
                    View Live Results (Researcher Only)
                </button>
            </div>
            
            <!-- Message Box -->
            <div id="messageBox" class="p-4 mt-6 hidden" role="alert">
                <p id="messageText" class="font-medium"></p>
                <p class="text-sm mt-1" id="messageSubText"></p>
            </div>
            
        </form>
        
        <!-- The results viewer will be dynamically inserted here -->

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            signInAnonymously, 
            signInWithCustomToken, 
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            query, 
            onSnapshot, 
            serverTimestamp 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Uncomment setLogLevel('Debug'); for detailed console logging for Firebase
        // import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        // setLogLevel('Debug'); 

        let db;
        let auth;
        let userId = 'anonymous'; // Default ID
        let RESEARCHER_USER_ID = null; // Stored ID of the user who owns this app (Renee)
        
        const APP_ID = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const FIREBASE_CONFIG = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const INITIAL_AUTH_TOKEN = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // **MANDATORY PUBLIC COLLECTION PATH**
        const COLLECTION_PATH = `/artifacts/${APP_ID}/public/data/survey_responses`;
        let isAuthReady = false;

        // UI elements
        const surveyContainer = document.getElementById('sandDollarSurveyForm');
        const viewResultsButton = document.getElementById('viewResultsButton');
        
        // Create results container dynamically and append it
        const resultsContainer = document.createElement('div');
        resultsContainer.id = 'survey-results-container';
        resultsContainer.className = 'hidden mt-10'; 
        document.querySelector('.max-w-3xl.mx-auto').appendChild(resultsContainer);
        
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');
        const messageSubText = document.getElementById('messageSubText');


        // --- UI State Management ---

        function showMessage(type, message, subText = '') {
            messageBox.classList.remove('hidden', 'bg-red-100', 'border-red-500', 'text-red-700', 'bg-yellow-100', 'border-yellow-500', 'text-yellow-700', 'bg-green-100', 'border-green-500', 'text-green-700');
            
            if (type === 'success') {
                messageBox.classList.add('bg-green-100', 'border-green-500', 'text-green-700');
            } else if (type === 'error') {
                messageBox.classList.add('bg-red-100', 'border-red-500', 'text-red-700');
            } else { // warning
                messageBox.classList.add('bg-yellow-100', 'border-yellow-500', 'text-yellow-700');
            }
            messageText.textContent = message;
            messageSubText.textContent = subText;
            messageSubText.classList.remove('hidden');
        }

        // Function to control access to the results button
        function checkPermissions() {
            // Only show the results button if the current user is the researcher
            if (userId === RESEARCHER_USER_ID) {
                viewResultsButton.classList.remove('hidden'); 
                console.log("Access Granted: Researcher View Enabled.");
            } else {
                viewResultsButton.classList.add('hidden');
                console.log("Access Denied: Hiding Results Button for participant.");
            }
        }
        
        function switchView(view) {
            if (view === 'survey') {
                surveyContainer.classList.remove('hidden');
                resultsContainer.classList.add('hidden');
                
                // Update button styles: survey button active, results button inactive
                if (userId === RESEARCHER_USER_ID) {
                    viewResultsButton.classList.remove('bg-blue-600', 'text-white', 'shadow-lg', 'shadow-blue-500/50');
                    viewResultsButton.classList.add('bg-gray-200', 'text-gray-800', 'shadow-md');
                }
                
                const submitButton = document.getElementById('submitButton');
                if (submitButton.textContent !== "Survey Completed") {
                    submitButton.classList.add('bg-blue-600', 'text-white', 'shadow-lg', 'shadow-blue-500/50');
                }
                
            } else if (view === 'results' && userId === RESEARCHER_USER_ID) {
                surveyContainer.classList.add('hidden');
                resultsContainer.classList.remove('hidden');
                
                // Update button styles: results button active, survey button inactive
                viewResultsButton.classList.add('bg-blue-600', 'text-white', 'shadow-lg', 'shadow-blue-500/50');
                viewResultsButton.classList.remove('bg-gray-200', 'text-gray-800', 'shadow-md');
                document.getElementById('submitButton').classList.remove('bg-blue-600', 'text-white', 'shadow-lg', 'shadow-blue-500/50');
                
                messageBox.classList.add('hidden'); // Hide general message box when viewing results
                fetchAndDisplayResults();
            }
        }
        
        // --- Firebase Initialization and Auth ---

        if (FIREBASE_CONFIG) {
            try {
                const app = initializeApp(FIREBASE_CONFIG);
                db = getFirestore(app);
                auth = getAuth(app);
                
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        isAuthReady = true;
                        
                        // Set the researcher ID only on initial authentication (this is Renee's ID)
                        if (!RESEARCHER_USER_ID) {
                            RESEARCHER_USER_ID = user.uid;
                        }
                        
                        console.log(`Firebase authenticated. Current User ID: ${userId}. Researcher ID: ${RESEARCHER_USER_ID}`);
                        checkPermissions(); // Check and display the button if needed
                        switchView('survey'); 
                    } else {
                        // Sign in anonymously if no user is present
                        if (INITIAL_AUTH_TOKEN) {
                            await signInWithCustomToken(auth, INITIAL_AUTH_TOKEN);
                        } else {
                            await signInAnonymously(auth);
                        }
                    }
                });

            } catch (error) {
                console.error("Firebase initialization failed:", error);
                showMessage('error', `Error initializing Firebase: ${error.message}. Data saving is disabled.`, "Please check your console for details.");
            }
        } else {
            isAuthReady = true; 
            console.warn("Firebase config not available. Data will not be saved persistently.");
            showMessage('warning', "Firestore is unavailable.", "Data will only be logged to the console.");
            switchView('survey'); 
        }

        // --- Data Submission Logic ---

        const handleSubmit = async (event) => {
            event.preventDefault();

            if (!isAuthReady) {
                showMessage('warning', "Please wait, authentication is still loading. Try again in a moment.", "");
                return;
            }

            const form = event.target;
            
            const consentValue = form.elements['consent'].value;
            if (consentValue !== 'Yes') {
                showMessage('error', "You must consent to participate to submit the survey.", "Select 'Yes, I consent to participate'.");
                return;
            }

            const getRadioValue = (name) => {
                const element = form.elements[name];
                if (element) {
                    return element.value;
                }
                return null;
            };

            const formData = {
                // Metadata
                user_id: userId,
                timestamp: db ? serverTimestamp() : new Date().toISOString(),
                
                // Researcher Info (for context)
                researcher: "Renee Darling Neymour",
                class: "BUSI-951-01 Introduction to Financial Technologies (FinTech) in Financial Services Fall 2025",
                
                // Consent & Demographics
                consent: getRadioValue('consent'),
                gender: getRadioValue('gender'),
                age_range: getRadioValue('age'),
                employment_status: getRadioValue('employment'),
                education_level: getRadioValue('education'),

                // Section 1: Barriers (Likert Scale: 1=Strongly Disagree, 5=Strongly Agree)
                q1_preference_for_existing: getRadioValue('q1_preference'),
                q2_merchant_acceptance: getRadioValue('q2_acceptance'),
                q3_trust_and_privacy: getRadioValue('q3_trust'),

                // Section 2: Incentives (Likert Scale: 1=Strongly Disagree, 5=Strongly Agree)
                q4_general_receptivity: getRadioValue('q4_general_incentive'),
                q5_specific_vat_credit_impact: getRadioValue('q5_vat_credit'),
                q6_switching_behavior: getRadioValue('q6_switching'),
                q7_importance_of_financial_benefit: getRadioValue('q7_importance'),
            };

            const requiredFields = [
                'consent', 'gender', 'age', 'employment', 'education', 
                'q1_preference', 'q2_acceptance', 'q3_trust', 
                'q4_general_incentive', 'q5_vat_credit', 'q6_switching', 'q7_importance'
            ];
            
            let allRequiredFilled = true;
            for (const fieldName of requiredFields) {
                if (!getRadioValue(fieldName)) {
                    allRequiredFilled = false;
                    break;
                }
            }

            if (!allRequiredFilled) {
                showMessage('warning', "Please answer all questions before submitting.", "");
                return;
            }
            
            document.getElementById('submitButton').textContent = "Submitting...";
            document.getElementById('submitButton').disabled = true;

            try {
                if (db) {
                    const docRef = await addDoc(collection(db, COLLECTION_PATH), formData);
                    console.log(`Document written with ID: ${docRef.id} in collection: ${COLLECTION_PATH}`);
                    showMessage('success', `Thank you for your participation! Your response is recorded.`, `Document ID: ${docRef.id} in ${COLLECTION_PATH}`);
                } else {
                    console.warn("Firestore not available. Logging to console only.");
                    console.log(JSON.stringify(formData, null, 2));
                    showMessage('warning', "Firestore is unavailable.", "Data was logged to the console, not saved.");
                }
                
                // Disable form elements after submission
                form.querySelectorAll('input').forEach(input => input.disabled = true);
                document.getElementById('submitButton').textContent = "Survey Completed";

            } catch (e) {
                console.error("Error adding document: ", e);
                showMessage('error', `Error submitting survey: ${e.message}`, "Please try refreshing the page.");
                
                // Re-enable form elements on error
                form.querySelectorAll('input').forEach(input => input.disabled = false);
                document.getElementById('submitButton').textContent = "Submit Survey";
                document.getElementById('submitButton').disabled = false;
            }
        };

        // Attach event listener to the form's submit event
        document.getElementById('sandDollarSurveyForm').addEventListener('submit', handleSubmit);

        // Make switchView globally accessible via the window object for inline onclick
        window.switchView = switchView;
        
        // --- Data Retrieval Logic (View Results) ---

        function fetchAndDisplayResults() {
            // Re-check permission just in case
            if (userId !== RESEARCHER_USER_ID) {
                resultsContainer.innerHTML = '<div class="p-6 mt-6 bg-red-100 border-l-4 border-red-500 text-red-700 rounded-lg"><p class="text-center font-medium">Access Denied: Only the researcher can view these results.</p></div>';
                return;
            }
            
            if (!isAuthReady || !db) {
                resultsContainer.innerHTML = '<div class="p-6 mt-6 bg-red-100 border-l-4 border-red-500 text-red-700 rounded-lg"><p class="text-center font-medium">Database not initialized or authentication pending. Please wait.</p></div>';
                return;
            }

            resultsContainer.innerHTML = `
                <div class="border-b pb-4 mb-4">
                    <button class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg text-sm font-semibold hover:bg-gray-300" onclick="switchView('survey')">
                        &larr; Return to Survey
                    </button>
                    <h3 class="text-2xl font-bold text-gray-800 mt-4">Live Survey Results</h3>
                    <p class="text-sm text-gray-600">
                        Collection: 
                        <span class="font-mono text-xs p-1 bg-gray-100 rounded">${COLLECTION_PATH.split('/').slice(-1).pop()}</span> 
                        | Your Researcher ID: <span class="font-mono text-xs p-1 bg-gray-100 rounded">${userId}</span>
                    </p>
                </div>
                <div id="resultsTableWrapper" class="overflow-x-auto relative shadow-md sm:rounded-lg">
                    <p class="text-center p-6 text-gray-500" id="loadingMessage">Loading real-time results...</p>
                </div>
            `;
            
            const resultsTableWrapper = document.getElementById('resultsTableWrapper');
            const loadingMessage = document.getElementById('loadingMessage');

            const q = query(collection(db, COLLECTION_PATH));

            // Set up real-time listener
            onSnapshot(q, (querySnapshot) => {
                const submissions = [];
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    // Convert Firestore timestamp to a readable string if available
                    let dateStr = 'N/A';
                    if (data.timestamp && data.timestamp.toDate) {
                        dateStr = data.timestamp.toDate().toLocaleDateString('en-US', {
                            month: 'short', 
                            day: 'numeric', 
                            hour: '2-digit', 
                            minute: '2-digit'
                        });
                    }
                    submissions.push({
                        id: doc.id,
                        date: dateStr,
                        ...data
                    });
                });

                if (loadingMessage) loadingMessage.classList.add('hidden');

                if (submissions.length === 0) {
                    resultsTableWrapper.innerHTML = '<p class="text-center p-6 text-gray-500 bg-white rounded-lg border">No submissions found yet. Be the first to submit!</p>';
                    return;
                }

                // Define the display columns in order
                const displayKeys = [
                    { key: 'date', label: 'Date', width: 'min-w-[120px]' },
                    { key: 'age_range', label: 'Age', width: 'min-w-[60px]' },
                    { key: 'education_level', label: 'Education', width: 'min-w-[100px]' },
                    { key: 'q3_trust_and_privacy', label: 'Q3 (Trust)', width: 'min-w-[70px]' },
                    { key: 'q5_specific_vat_credit_impact', label: 'Q5 (VAT)', width: 'min-w-[70px]' },
                    { key: 'q6_switching_behavior', label: 'Q6 (Switch)', width: 'min-w-[70px]' },
                ];
                
                // Build the table HTML
                let tableHTML = `
                    <table class="w-full text-sm text-left text-gray-500">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                            <tr>
                                ${displayKeys.map(col => `<th scope="col" class="px-3 py-3 ${col.width}">${col.label}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
                            ${submissions.map(sub => `
                                <tr class="bg-white border-b hover:bg-gray-50">
                                    ${displayKeys.map(col => {
                                        let cellContent = sub[col.key];
                                        if (col.key === 'id') {
                                            cellContent = sub.id.substring(0, 8) + '...'; // Truncate ID
                                        }
                                        return `<td class="px-3 py-4 font-medium text-gray-900 whitespace-nowrap">${cellContent}</td>`;
                                    }).join('')}
                                </tr>
                            `).join('')}
                        </tbody>
                        <tfoot class="text-xs text-gray-700 uppercase bg-gray-50">
                             <tr>
                                <th scope="col" colspan="${displayKeys.length}" class="px-6 py-3 text-center bg-gray-50 font-bold text-gray-700">Total Responses: ${submissions.length}</th>
                            </tr>
                        </tfoot>
                    </table>
                `;
                
                resultsTableWrapper.innerHTML = tableHTML;
            }, (error) => {
                console.error("Error fetching documents:", error);
                if (loadingMessage) loadingMessage.classList.add('hidden');
                resultsTableWrapper.innerHTML = `<p class="text-center p-6 text-red-600 bg-white rounded-lg border">Error loading data: ${error.message}</p>`;
            });
        }
    </script>
</body>
</html>
